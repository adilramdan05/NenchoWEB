<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nenmatsuchousei Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h2>Nenmatsuchousei Form</h2>
  <form id="myForm">
    <label>Name: <input type="text" id="name" required></label><br><br>
    <label>Email: <input type="email" id="email" required></label><br><br>
    <label>Message:<br>
      <textarea id="message" rows="5" cols="30"></textarea>
    </label><br><br>
    <button type="button" id="submitBtn">Submit</button>
  </form>

  <script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbwTi-4G3hygk1gLP2Ys7-Vfz6_RtUbyrRa7oQ4Pq026VYWqjCDog7syNHW1msgY3uDN/exec";

    const { jsPDF } = window.jspdf;

    function getTimestamp() {
      const now = new Date();
      return now.getFullYear() + "-" +
             String(now.getMonth()+1).padStart(2,'0') + "-" +
             String(now.getDate()).padStart(2,'0') + "_" +
             String(now.getHours()).padStart(2,'0') + "-" +
             String(now.getMinutes()).padStart(2,'0') + "-" +
             String(now.getSeconds()).padStart(2,'0');
    }

    document.getElementById("submitBtn").addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const message = document.getElementById("message").value.trim();

      if (!name || !email) { 
        alert("Name & Email are required!"); 
        return; 
      }

      const doc = new jsPDF();
      doc.text(`Name: ${name}`, 10, 10);
      doc.text(`Email: ${email}`, 10, 20);
      doc.text(`Message: ${message}`, 10, 30);

      const filename = `${name}_${getTimestamp()}.pdf`;
      const pdfBase64 = doc.output('datauristring').split(',')[1];

      // Send PDF to Apps Script
      fetch(scriptUrl, {
        method: "POST",
        body: JSON.stringify({filename: filename, data: pdfBase64}),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.text())
      .then(response => alert(response))
      .catch(err => alert("Error: " + err));
    });
  </script>
</body>
</html>
